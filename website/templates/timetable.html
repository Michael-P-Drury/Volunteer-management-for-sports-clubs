{% extends "layout.html" %}

{% block page_content %}
<div class="timetable-title-box">
    <h1 class='timetable-title'>Timetable</h1>
</div>

{% if jobs %}
<p class="timetable-guide">Click on jobs to see more details and request to volunteer for jobs</p>

<div class="timetable-boxes">
    {% for job in jobs %}
    <div class="job-content">
        <element onclick="togglePopup('{{ job.job_id }}')">
            <div class="job-box">
                <div class="job-name-box">
                    <div class="job-name"><b>{{ job.job_name }}</b></div>
                </div>
                <div>
                    <span>Volunteers Needed:</span>
                    <span>{{ job.volunteers_needed }}</span>
                </div>
                <div>
                    <span>Date:</span>
                    <span class="job-box-data">{{ job.date }}</span>
                </div>
                <div>
                    <span>Start time: {{ job.start_time }}</span>
                    <span class="job-box-data">End time: {{ job.end_time }}</span>
                </div>

                {% if current_user_id in (job.volunteers_assigned.split()) %}
                <div>
                    <span>You are assigned to this job</span>

                    <form method = "post">
                        <input type = "hidden" name = "remove_request_job_id" value = {{ job.job_id }}>
                        <input type = "submit" value = "request remove from job">
                    </form>

                </div>
                {% endif %}

                {% if current_user_id not in (job.volunteers_assigned.split()) %}
                {% if not Requests.query.filter(Requests.user_id.any(user_id=current_user_id), Requests.job_id.any(job_id=job.job_id)).first() %}

                <form method = "post">
                    <input type = "hidden" name = "job_id_request" value = {{ job.job_id }}>
                    <input type = "submit" value = "request job">
                </form>

                {% endif %}
                {% endif %}

                {% if Requests.query.filter(Requests.user_id.any(user_id=current_user_id), Requests.job_id.any(job_id=job.job_id)).first() %}
                <div>
                    <span>You have requested for this job</span>
                </div>
                {% endif %}

            </div>
        </element>
    
        <div class="popup" id = "popup-{{ job.job_id }}" >
            <div class="popup-overlay"></div>
            <div class="popup-content">
                <div class="popup-close-btn" onclick="togglePopup('{{ job.job_id }}')" >&times;</div>
                <div class= "popup-job-name-box">
                    <p class="job-name"><b>{{ job.job_name }}</b></p>
                </div>
                <div class="popup-info">
                    <p>Volunteers Needed: {{ job.volunteers_needed }}</p>
                    <p>Volunteers Assigned: {{ job.volunteers_assigned }}</p>
                    <hr>
                    <p>Date: {{ job.date }}</p>
                    <p>Time: {{ job.start_time }} - {{ job.end_time }}</p>
                    <hr>
                    <p>{{ job.job_description }}</p>
                    <hr>
                    <p>Requirements: {{ job.job_requirements }}</p>

                    {% if current_user_id not in (job.volunteers_assigned.split()) %}
                    {% if not Requests.query.filter(Requests.user_id.any(user_id=current_user_id), Requests.job_id.any(job_id=job.job_id)).first() %}

                    <form method = "post">
                        <input type = "hidden" name = "job_id_request" value = {{ job.job_id }}>
                        <input type = "submit" value = "request job">
                    </form>

                    {% endif %}
                    {% endif %}

                    {% if current_user_id in (job.volunteers_assigned.split()) %}
                    <p>You are assigned to this job</p>

                    <form method = "post">
                        <input type = "hidden" name = "remove_request_job_id" value = {{ job.job_id }}>
                        <input type = "submit" value = "request remove from job">
                    </form>

                    {% endif %}

                    {% if Requests.query.filter(Requests.user_id.any(user_id=current_user_id), Requests.job_id.any(job_id=job.job_id)).first() %}
                    <div>
                        <span>You have requested for this job</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<div class="no-jobs">
    <h1>No jobs found</h1>
    <p>There currently seems to be no available jobs at this moment.</p>
</div>

{% endif %}
<script>
    function togglePopup(jobId){
        document.getElementById("popup-" + jobId).classList.toggle("active");
    }
</script>
{% endblock %}